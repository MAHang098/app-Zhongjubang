(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/releaseImage/release-image/release-image"],{"0c3f":function(t,e,a){"use strict";a.r(e);var i=a("f4c6"),o=a("c74d");for(var s in o)"default"!==s&&function(t){a.d(e,t,function(){return o[t]})}(s);a("2806");var n=a("2877"),r=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},2806:function(t,e,a){"use strict";var i=a("c2fe"),o=a.n(i);o.a},"8beb":function(t,e,a){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){return a.e("components/uni-popup/uni-popup").then(a.bind(null,"73b7"))},s={components:{uniPopup:o},data:function(){return{remnant:0,desc:"",allImage:[],allTag:[],imgList:[],isUpload:!0,participationTopic:"参与话题",participationTopicId:"",ishow:!0,previewType:"",appUserDraftsId:"",show:!1,popupType:"",gcircleContentId:"",isshowScusse:!1}},onShow:function(t){var e=getCurrentPages();e[e.length-1]},onLoad:function(e){""!=this.$store.state.topic&&(this.participationTopic=this.$store.state.topic,this.participationTopicId=this.$store.state.topicId),console.log(t(this.participationTopic,this.participationTopicId," at pages\\releaseImage\\release-image\\release-image.vue:102"));var a=this.$store.state.drafts;a.length>0&&(this.desc=a[0].content,this.remnant=a[0].content.length,this.appUserDraftsId=a[0].id,(a[0].type&&"user"==a[0].type||a[0].type&&"juquan"==a[0].type)&&(this.gcircleContentId=a[0].editId)),e.type&&(this.previewType=e.type),this.allImage=this.$store.state.uploadImage,this.allImage.length>8&&(this.isUpload=!1)},onNavigationBarButtonTap:function(t){},onBackPress:function(e){if(console.log(t(e," at pages\\releaseImage\\release-image\\release-image.vue:128")),"backbutton"==e.from)return!0},methods:{release:function(){var t=this,e="";if(i.getStorage({key:"token",success:function(t){e=t.data}}),i.showLoading({title:"请稍等"}),!this.isshowScusse){"参与话题"==this.participationTopic&&(this.participationTopic="");var a={topic:this.participationTopic,topicId:this.participationTopicId},o={content:this.desc,imgList:JSON.stringify(this.allImage),title:JSON.stringify(a)};if(""!=this.desc||0!=this.allImage.length){if(this.isshowScusse=!0,this.gcircleContentId)return o.gcircleContentId=this.gcircleContentId,void i.request({url:this.url+"controller/usercontroller/updategetgcirclecontent",method:"post",data:o,header:{"content-type":"application/x-www-form-urlencoded",token:e,port:"app"},success:function(e){200==e.data.code&&(i.showToast({title:"发布成功",duration:500}),setTimeout(function(){i.switchTab({url:"/pages/user/user"})},500),i.hideLoading(),t.isshowScusse=!1,t.$store.commit("clearData",[]),t.$store.commit("clearDrafts",[]),t.$store.commit("defaultPage",""),t.$store.commit("updateType",{topic:"",topicId:""})),421==e.data.code&&i.navigateTo({url:"/pages/loginPhone/loginPhone"})}});i.request({url:this.url+"controller/usercontroller/addgcirclecontent",method:"post",data:o,header:{"content-type":"application/x-www-form-urlencoded",token:e,port:"app"},success:function(e){200==e.data.code&&(i.showToast({title:"发布成功",duration:500}),setTimeout(function(){i.switchTab({url:"/pages/user/user"})},500),i.hideLoading(),t.$store.commit("clearData",[]),t.$store.commit("clearDrafts",[]),t.$store.commit("defaultPage",""),t.$store.commit("updateType",{topic:"",topicId:""}),t.isshowScusse=!1),421==e.data.code&&i.navigateTo({url:"/pages/loginPhone/loginPhone"})}})}else i.showToast({title:"请分享经验或者上传图片",icon:"none"})}},cancel:function(){return this.togglePopup("center","tip"),!0},saveDrafts:function(){var t=this,e="";i.getStorage({key:"token",success:function(t){e=t.data}}),"参与话题"==this.participationTopic&&(this.participationTopic="");var a=[{content:this.desc,imgList:this.allImage,title:{topic:this.participationTopic,topicId:this.participationTopicId}}],o=JSON.stringify(a),s={type:1,draftsContent:o};if(this.appUserDraftsId){var n={appUserDraftsId:this.appUserDraftsId,draftsContent:o};i.request({url:this.url+"controller/videocontroller/updateappuserdrafts",method:"post",data:n,header:{"content-type":"application/x-www-form-urlencoded",token:e,port:"app"},success:function(e){200==e.data.code&&(i.showToast({title:"保存成功",duration:500}),t.show=!1,t.$store.commit("clearData",[]),t.$store.commit("clearDrafts",[]),t.$store.commit("defaultPage",""),t.$store.commit("updateType",{topic:"",topicId:""}),setTimeout(function(){i.switchTab({url:"/pages/user/user"})},1e3)),421==e.data.code&&i.navigateTo({url:"/pages/loginPhone/loginPhone"})}})}else i.request({url:this.url+"controller/videocontroller/addappuserdrafts",method:"post",data:s,header:{"content-type":"application/x-www-form-urlencoded",token:e,port:"app"},success:function(e){200==e.data.code&&(i.showToast({title:"保存成功",duration:500}),t.show=!1,t.$store.commit("clearData",[]),t.$store.commit("clearDrafts",[]),t.$store.commit("defaultPage",""),t.$store.commit("updateType",{topic:"",topicId:""}),setTimeout(function(){i.switchTab({url:"/pages/user/user"})},1e3)),421==e.data.code&&i.navigateTo({url:"/pages/loginPhone/loginPhone"})}})},descInput:function(t){this.remnant=t.detail.value.length},addTopic:function(){""==this.$store.state.topic?i.navigateTo({url:"/pages/releaseImage/search-title/search-title"}):i.showToast({icon:"none",title:"当前不能修改话题"})},previewImage:function(t){if("addTag"==this.previewType){var e=getCurrentPages(),a=(e[e.length-1],e[e.length-2]);a&&(a.current=t,a.setData({current:t})),i.navigateBack()}else{var o=t+1;i.navigateTo({url:"/pages/releaseImage/add-tag/add-tag?current="+t+"&indexImg="+o})}},deleteImage:function(t,e){this.allImage.forEach(function(a,i,o){a.fileName==t&&e==i&&o.splice(e,1)}),this.isUpload=!0,this.$store.commit("saveImage",this.allImage)},chooseImage:function(){var t=this.$store.state.uploadImage;if(t.length>8)this.isUpload=!1;else{var e=this;i.chooseImage({count:9,sourceType:["album"],success:function(t){i.showLoading({title:"请稍等",mask:!0});var a=t.tempFilePaths;for(var o in a)i.uploadFile({url:e.url+"/upload",filePath:a[o],name:"file",formData:{},success:function(t){i.hideLoading();var o=JSON.parse(t.data),s={fileName:o.data.fileName,fileUrl:o.data.fileUrl,type:"pre-release",testArr:[]};if(e.imgList.push(s),e.imgList.type="pre-release",e.imgList.length==a.length){var n=e.allImage.length,r=getCurrentPages(),c=(r[r.length-1],r[r.length-2]);if(c&&(c.current=n,c.indexImg=n+1,c.setData({current:n,indexImg:n+1})),e.$store.commit("saveImage",e.imgList),"addTag"!=e.previewType){var p=n+1;return void i.navigateTo({url:"/pages/releaseImage/add-tag/add-tag?current="+n+"&indexImg="+p})}i.navigateBack()}}})}})}},togglePopup:function(t,e){switch(t){case"top":this.content="顶部弹出 popup";break;case"bottom":this.content="底部弹出 popup";break;case"center":this.content="居中弹出 popup";break}this.popupType=t,"tip"===e?this.show=!0:this.$refs[e].open()},cancelPopup:function(t){var e=this.$store.state.drafts;if("tip"===t)return this.show=!1,this.$store.commit("clearData",[]),this.$store.commit("clearDrafts",[]),this.$store.commit("defaultPage",""),this.$store.commit("updateType",{topic:"",topicId:""}),""==this.previewType?void i.navigateBack({delta:1}):"drafts"==this.previewType||0!=e.length&&"drafts"==e[0].type?void i.navigateTo({url:"/pages/drafts/drafts"}):"user"==this.previewType||0!=e.length&&"drafts"==e[0].type?void i.switchTab({url:"/pages/main/main"}):"juquan"==this.previewType||0!=e.length&&"juquan"==e[0].type?void i.switchTab({url:"/pages/juquan/juquan"}):void setTimeout(function(){i.switchTab({url:"/pages/user/user"})},1e3);"skip"===t&&this.saveDrafts()}}};e.default=s}).call(this,a("0de9")["default"],a("6e42")["default"])},c2fe:function(t,e,a){},c74d:function(t,e,a){"use strict";a.r(e);var i=a("8beb"),o=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=o.a},d494:function(t,e,a){"use strict";(function(t){a("19df"),a("921b");i(a("66fd"));var e=i(a("0c3f"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},f4c6:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return o})}},[["d494","common/runtime","common/vendor"]]]);