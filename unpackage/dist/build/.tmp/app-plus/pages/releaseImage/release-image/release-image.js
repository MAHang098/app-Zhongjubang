(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/releaseImage/release-image/release-image"],{"056b":function(t,e,a){},"05dd":function(t,e,a){"use strict";a.r(e);var i=a("e575"),o=a.n(i);for(var s in i)"default"!==s&&function(t){a.d(e,t,function(){return i[t]})}(s);e["default"]=o.a},6508:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"a",function(){return i}),a.d(e,"b",function(){return o})},"985c":function(t,e,a){"use strict";(function(t){a("0497"),a("921b");i(a("66fd"));var e=i(a("b1f0"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},b1f0:function(t,e,a){"use strict";a.r(e);var i=a("6508"),o=a("05dd");for(var s in o)"default"!==s&&function(t){a.d(e,t,function(){return o[t]})}(s);a("c095");var n=a("2877"),r=Object(n["a"])(o["default"],i["a"],i["b"],!1,null,null,null);e["default"]=r.exports},c095:function(t,e,a){"use strict";var i=a("056b"),o=a.n(i);o.a},e575:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){return a.e("components/uni-popup/uni-popup").then(a.bind(null,"0aab"))},o={components:{uniPopup:i},data:function(){return{remnant:0,desc:"",allImage:[],allTag:[],imgList:[],isUpload:!0,participationTopic:"参与话题",participationTopicId:"",ishow:!0,previewType:"",appUserDraftsId:"",show:!1,popupType:"",gcircleContentId:""}},onShow:function(t){var e=getCurrentPages(),a=e[e.length-1];a&&(void 0==a.data.participationTopic||""==a.data.participationTopic||(this.participationTopic=a.data.participationTopic,this.participationTopicId=a.data.participationTopicId))},onLoad:function(t){""!=this.$store.state.topic&&(this.participationTopic=this.$store.state.topic,this.participationTopicId=this.$store.state.topicId);var e=this.$store.state.drafts;e.length>0&&(this.desc=e[0].content,this.remnant=e[0].content.length,this.appUserDraftsId=e[0].id,(e[0].type&&"user"==e[0].type||e[0].type&&"juquan"==e[0].type)&&(this.gcircleContentId=e[0].editId)),t.type&&(this.previewType=t.type),this.allImage=this.$store.state.uploadImage,this.allImage.length>8&&(this.isUpload=!1)},onNavigationBarButtonTap:function(t){},methods:{release:function(){var e=this,a="";t.getStorage({key:"token",success:function(t){a=t.data}}),"参与话题"==this.participationTopic&&(this.participationTopic="");var i={topic:this.participationTopic,topicId:this.participationTopicId},o={content:this.desc,imgList:JSON.stringify(this.allImage),title:JSON.stringify(i)};if(this.gcircleContentId)return o.gcircleContentId=this.gcircleContentId,void t.request({url:this.url+"controller/usercontroller/updategetgcirclecontent",method:"post",data:o,header:{"content-type":"application/x-www-form-urlencoded",token:a,port:"app"},success:function(a){200==a.data.code&&(421==a.data.code&&t.navigateTo({url:"/pages/loginPhone/loginPhone"}),e.$store.commit("clearData",[]),e.$store.commit("clearDrafts",[]),e.$store.commit("defaultPage",""),e.$store.commit("updateType",{topic:"",topicId:""}),t.showToast({title:"发布成功",duration:500}),setTimeout(function(){t.switchTab({url:"/pages/user/user"})},1e3)),421==a.data.code&&t.navigateTo({url:"/pages/loginPhone/loginPhone"})}});t.request({url:this.url+"controller/usercontroller/addgcirclecontent",method:"post",data:o,header:{"content-type":"application/x-www-form-urlencoded",token:a,port:"app"},success:function(a){200==a.data.code&&(e.$store.commit("clearData",[]),e.$store.commit("clearDrafts",[]),e.$store.commit("defaultPage",""),e.$store.commit("updateType",{topic:"",topicId:""}),t.showToast({title:"发布成功",duration:500}),setTimeout(function(){t.switchTab({url:"/pages/user/user"})},1e3)),421==a.data.code&&t.navigateTo({url:"/pages/loginPhone/loginPhone"})}})},cancel:function(){return this.togglePopup("center","tip"),!0},saveDrafts:function(){var e=this,a="";t.getStorage({key:"token",success:function(t){a=t.data}}),"参与话题"==this.participationTopic&&(this.participationTopic="");var i=[{content:this.desc,imgList:this.allImage,title:{topic:this.participationTopic,topicId:this.participationTopicId}}],o=JSON.stringify(i),s={type:1,draftsContent:o};if(this.appUserDraftsId){var n={appUserDraftsId:this.appUserDraftsId,draftsContent:o};t.request({url:this.url+"controller/videocontroller/updateappuserdrafts",method:"post",data:n,header:{"content-type":"application/x-www-form-urlencoded",token:a,port:"app"},success:function(a){200==a.data.code&&(t.showToast({title:"保存成功",duration:500}),e.show=!1,e.$store.commit("clearData",[]),e.$store.commit("clearDrafts",[]),e.$store.commit("defaultPage",""),e.$store.commit("updateType",{topic:"",topicId:""}),setTimeout(function(){t.switchTab({url:"/pages/user/user"})},1e3)),421==a.data.code&&t.navigateTo({url:"/pages/loginPhone/loginPhone"})}})}else t.request({url:this.url+"controller/videocontroller/addappuserdrafts",method:"post",data:s,header:{"content-type":"application/x-www-form-urlencoded",token:a,port:"app"},success:function(a){200==a.data.code&&(t.showToast({title:"保存成功",duration:500}),e.show=!1,e.$store.commit("clearData",[]),e.$store.commit("clearDrafts",[]),e.$store.commit("defaultPage",""),e.$store.commit("updateType",{topic:"",topicId:""}),setTimeout(function(){t.switchTab({url:"/pages/user/user"})},1e3)),421==a.data.code&&t.navigateTo({url:"/pages/loginPhone/loginPhone"})}})},descInput:function(t){this.remnant=t.detail.value.length},addTopic:function(){""==this.$store.state.topic?t.navigateTo({url:"/pages/releaseImage/search-title/search-title"}):t.showToast({icon:"none",title:"当前不能修改话题"})},previewImage:function(e){if("addTag"==this.previewType){var a=getCurrentPages(),i=(a[a.length-1],a[a.length-2]);i&&(i.current=e,i.setData({current:e})),t.navigateBack()}else{var o=e+1;t.navigateTo({url:"/pages/releaseImage/add-tag/add-tag?current="+e+"&indexImg="+o})}},deleteImage:function(t,e){this.allImage.forEach(function(a,i,o){a.fileName==t&&e==i&&o.splice(e,1)}),this.isUpload=!0,this.$store.commit("saveImage",this.allImage)},chooseImage:function(){var e=this.$store.state.uploadImage;if(e.length>8)this.isUpload=!1;else{var a=this;t.chooseImage({count:9,sourceType:["album"],success:function(e){t.showLoading({title:"请稍等",mask:!0});var i=e.tempFilePaths;for(var o in i)t.uploadFile({url:a.url+"/upload",filePath:i[o],name:"file",formData:{},success:function(e){t.hideLoading();var o=JSON.parse(e.data),s={fileName:o.data.fileName,fileUrl:o.data.fileUrl,type:"pre-release",testArr:[]};if(a.imgList.push(s),a.imgList.type="pre-release",a.imgList.length==i.length){var n=a.allImage.length,r=getCurrentPages(),c=(r[r.length-1],r[r.length-2]);if(c&&(c.current=n,c.indexImg=n+1,c.setData({current:n,indexImg:n+1})),a.$store.commit("saveImage",a.imgList),"addTag"!=a.previewType){var p=n+1;return void t.navigateTo({url:"/pages/releaseImage/add-tag/add-tag?current="+n+"&indexImg="+p})}t.navigateBack()}}})}})}},togglePopup:function(t,e){switch(t){case"top":this.content="顶部弹出 popup";break;case"bottom":this.content="底部弹出 popup";break;case"center":this.content="居中弹出 popup";break}this.popupType=t,"tip"===e?this.show=!0:this.$refs[e].open()},cancelPopup:function(e){var a=this.$store.state.drafts;if("tip"===e)return this.show=!1,this.$store.commit("clearData",[]),this.$store.commit("clearDrafts",[]),this.$store.commit("defaultPage",""),this.$store.commit("updateType",{topic:"",topicId:""}),""==this.previewType?void t.navigateBack({delta:1}):"drafts"==this.previewType||0!=a.length&&"drafts"==a[0].type?void t.navigateTo({url:"/pages/drafts/drafts"}):"user"==this.previewType||0!=a.length&&"drafts"==a[0].type?void t.switchTab({url:"/pages/main/main"}):"juquan"==this.previewType||0!=a.length&&"juquan"==a[0].type?void t.switchTab({url:"/pages/juquan/juquan"}):void setTimeout(function(){t.switchTab({url:"/pages/user/user"})},1e3);"skip"===e&&this.saveDrafts()}}};e.default=o}).call(this,a("6e42")["default"])}},[["985c","common/runtime","common/vendor"]]]);